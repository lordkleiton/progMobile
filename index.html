<!doctype html>
<html>
<head>
	<title>oi</title>
	<style type="text/css">
		#snapshot, #player {
			display: none;
		}
	</style>
</head>
<body>
<video id="player" controls autoplay></video>
<h1 id="oi">oi</h1>
<button id="usaCamera">Usar camera</button>
<button id="capture">Capture</button>
<button id="inverter">Inverter</button>
<button id="sepia">Sepia</button>
<button id="gs">Tons de cinza</button>
<button id="og">Original</button>
<button id="posi">posicao</button>
<button id="compPosi">compartilha</button>
	
<h1 id="aceleracao"></h1>
<canvas id="snapshot"></canvas>
<script>

	//camera
  var player = document.getElementById('player'); 
  var snapshotCanvas = document.getElementById('snapshot');
  var captureButton = document.getElementById('capture');


  var btnInverter = document.getElementById('inverter');
  var btnSepia = document.getElementById('sepia');
  var btnGS = document.getElementById('gs');
  var btnOG = document.getElementById('og');
  var btnUsaCamera = document.getElementById('usaCamera');
	//só funciona no chrome mobile acima do 61
  var btnCompPosi = document.getElementById('compPosi');

  var handleSuccess = function(stream) {    
    player.srcObject = stream;
    player.removeAttribute("controls");
    player.style.display = "block";
  };
	
	snapshotCanvas.style.width = player.style.width;
	snapshotCanvas.style.height = player.style.height;
	console.log(player.style.width);

	
  btnInverter.addEventListener('click', function(){
  	snapshotCanvas.style.filter = "invert(1)";
  });

  btnGS.addEventListener('click', function(){
  	snapshotCanvas.style.filter = "grayscale(100%)";
  });

  btnSepia.addEventListener('click', function(){
  	snapshotCanvas.style.filter = "sepia(100%)";
  });

  btnOG.addEventListener('click', function(){
  	snapshotCanvas.style.filter = "none";
  });

  btnUsaCamera.addEventListener('click', function(){
  	navigator.mediaDevices.getUserMedia({video: true})
      .then(handleSuccess);
  });

	//só funciona no chrome mobile acima do 61
  btnCompPosi.addEventListener('click', function(){
  	if (navigator.share) {
	  navigator.share({
		  title: 'aaaaaaaa',
	      text: 'Latitude e longitude: ',
		  url: 'www.aaaaa.aaa',
	  })
	  .then(() => console.log('Successful share'))
	  .catch((error) => console.log('Error sharing', error));
	}
  });

  captureButton.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
    // Draw the video frame to the canvas.
    context.drawImage(player, 0, 0, snapshotCanvas.width, 
        snapshotCanvas.height);

    snapshotCanvas.style.display = "block";
  });


  //localizacao
  var btnPosi = document.getElementById("posi");
  var x = document.getElementById("oi");

  btnPosi.addEventListener('click', function(){
  	getLocation();
  });

	function getLocation() {
	    if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(showPosition);
	    } else {
	        x.innerHTML = "Geolocation is not supported by this browser.";
	    }
	}
	function showPosition(position) {
	    x.innerHTML = "Latitude: " + position.coords.latitude + 
	    "<br>Longitude: " + position.coords.longitude; 
	}
	
	//negocio la de tremer
	var z = document.getElementById("aceleracao");
	//window.addEventListener('devicemotion', function(event) {
  	//	z.innerHTML = event.acceleration.x + ' : ' + event.acceleration.y + ' : ' + event.acceleration.z;
	//});
	
	window.addEventListener('devicemotion', motion, false);
	
	let lastX, lastY, lastZ;
let moveCounter = 0;
	
	var numero = 0;

function motion(e) {
    let acc = e.acceleration;
    if(!acc.hasOwnProperty('x')) {
        acc = e.accelerationIncludingGravity;
    }
	e.interval = 1000;
	
	

    if(!acc.x) return;

    //only log if x,y,z > 1
    if(Math.abs(acc.x) >= 1 &&
    Math.abs(acc.y) >= 1 &&
    Math.abs(acc.z) >=1) {
        //console.log('motion', acc);
        if(!lastX) {
            lastX = acc.x;
            lastY = acc.y;
            lastZ = acc.z;
            return;
        }

        let deltaX = acc.x - lastX;//Math.abs(acc.x - lastX);
        let deltaY = acc.y - lasty;//Math.abs(acc.y - lastY);
        let deltaZ = acc.z - lastz;//Math.abs(acc.z - lastZ);
	    
	    
        
        if(deltaX + deltaY + deltaZ > 20) {
            moveCounter++;
        } else {
            moveCounter = Math.max(0, --moveCounter);
        }

        if(moveCounter > 3) {
		numero++;
            
            moveCounter = 0;
        }
	    if (numero > 3)
		    numero = 0;
	    
	    switch (numero){
			case 0:
				snapshotCanvas.style.filter = "invert(1)";
				break;
			case 1:
				snapshotCanvas.style.filter = "grayscale(100%)";
				break;
			case 2:
				snapshotCanvas.style.filter = "sepia(100%)";
				break;
			case 3:
				snapshotCanvas.style.filter = "none";
				break;
		}
	    z.innerHTML = numero;
	    console.log(numero);

        lastX = acc.x;
        lastY = acc.y;
        lastZ = acc.z;
        
    }
}

</script>
</body>
</html>
